<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 음성 안내 테스트</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            border-radius: 10px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
        }
        
        .button-group {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .status.loading {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
        }
        
        .status.success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
        }
        
        .status.error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
        }
        
        .audio-player {
            margin: 15px 0;
        }
        
        audio {
            width: 100%;
            border-radius: 10px;
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .preset-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: left;
            padding: 15px;
            font-size: 13px;
        }
        
        .voice-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .voice-setting {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        select, input[type="range"] {
            padding: 8px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .range-value {
            font-size: 12px;
            text-align: center;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎤 AI 음성 안내 테스트</h1>
            <p>Vrew AI 또는 Web Speech API를 사용한 음성 안내 기능 테스트</p>
        </div>

        <!-- 1. Web Speech API 테스트 (기본 브라우저 TTS) -->
        <div class="test-section">
            <div class="test-title">
                🗣️ Web Speech API 테스트 (기본 브라우저 음성)
            </div>
            <textarea id="textInput1" placeholder="음성으로 읽을 텍스트를 입력하세요...">안녕하세요! 던롭필로 모션베드에 오신 것을 환영합니다. 이제 편안한 수면의 세계로 안내해드리겠습니다.</textarea>
            
            <div class="voice-settings">
                <div class="voice-setting">
                    <label>음성 선택:</label>
                    <select id="voiceSelect"></select>
                </div>
                <div class="voice-setting">
                    <label>속도:</label>
                    <input type="range" id="rateRange" min="0.5" max="2" step="0.1" value="1">
                    <div class="range-value" id="rateValue">1.0</div>
                </div>
                <div class="voice-setting">
                    <label>음높이:</label>
                    <input type="range" id="pitchRange" min="0" max="2" step="0.1" value="1">
                    <div class="range-value" id="pitchValue">1.0</div>
                </div>
                <div class="voice-setting">
                    <label>볼륨:</label>
                    <input type="range" id="volumeRange" min="0" max="1" step="0.1" value="1">
                    <div class="range-value" id="volumeValue">1.0</div>
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="speakText()">🔊 음성 재생</button>
                <button onclick="stopSpeaking()">⏹️ 정지</button>
                <button onclick="pauseSpeaking()">⏸️ 일시정지</button>
                <button onclick="resumeSpeaking()">▶️ 재개</button>
            </div>
            
            <div id="status1" class="status"></div>
        </div>

        <!-- 2. 페이지별 음성 안내 미리보기 -->
        <div class="test-section">
            <div class="test-title">
                📱 페이지별 음성 안내 미리보기
            </div>
            
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadPresetText('home')">
                    🏠 홈 화면<br>
                    <small>환영 메시지</small>
                </button>
                <button class="preset-btn" onclick="loadPresetText('page2')">
                    🛏️ 페이지 2<br>
                    <small>모션베드 소개</small>
                </button>
                <button class="preset-btn" onclick="loadPresetText('page3')">
                    ⚡ 페이지 3<br>
                    <small>기능 설명</small>
                </button>
                <button class="preset-btn" onclick="loadPresetText('page16')">
                    💡 페이지 16<br>
                    <small>마무리 안내</small>
                </button>
            </div>
            
            <textarea id="textInput2" placeholder="선택한 페이지의 음성 안내 텍스트가 여기에 표시됩니다..."></textarea>
            
            <div class="button-group">
                <button onclick="speakPageText()">🔊 페이지 음성 재생</button>
                <button onclick="testAllPages()">🎯 전체 페이지 테스트</button>
            </div>
            
            <div id="status2" class="status"></div>
        </div>

        <!-- 3. Vrew AI API 테스트 (향후 구현) -->
        <div class="test-section">
            <div class="test-title">
                🤖 Vrew AI API 테스트 (향후 구현)
            </div>
            <p>• Vrew AI API 키 설정</p>
            <p>• 고품질 AI 음성 생성</p>
            <p>• 자연스러운 억양과 감정 표현</p>
            
            <textarea id="textInput3" placeholder="Vrew AI로 생성할 텍스트..." disabled>아직 구현 중입니다. Web Speech API로 먼저 테스트해보세요!</textarea>
            
            <div class="button-group">
                <button disabled>🔊 Vrew AI 음성 생성</button>
                <button disabled>💾 음성 파일 저장</button>
            </div>
            
            <div id="status3" class="status">
                Vrew AI 연동은 API 키와 서버 설정이 필요합니다.
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentUtterance = null;
        let voices = [];
        
        // 페이지별 음성 안내 텍스트
        const PAGE_VOICE_SCRIPTS = {
            home: "안녕하세요! 던롭필로 모션베드 체험에 오신 것을 환영합니다. 저는 여러분의 편안한 수면을 위한 AI 가이드입니다. 이제 함께 모션베드의 놀라운 기능들을 체험해보겠습니다.",
            
            page2: "이제 던롭필로 모션베드의 기본 기능을 살펴보겠습니다. 모션베드는 여러분의 몸에 맞춰 자동으로 조절되는 똑똑한 침대입니다. 헤드와 풋 부분을 자유롭게 조절할 수 있어요.",
            
            page3: "모션베드의 특별한 기능을 체험해보세요. 리모컨을 사용해서 원하는 각도로 조절할 수 있습니다. 독서할 때, TV를 볼 때, 또는 다리를 올리고 싶을 때 완벽한 자세를 만들어보세요.",
            
            page16: "체험이 거의 끝나가네요! 던롭필로 모션베드와 천연 라텍스 매트리스의 조합은 여러분께 최고의 수면 경험을 선사할 것입니다. 편안한 밤과 상쾌한 아침을 위한 완벽한 선택이에요."
        };

        // 음성 초기화
        function initVoices() {
            voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '';
            
            // 한국어 음성 우선으로 정렬
            const koreanVoices = voices.filter(voice => voice.lang.includes('ko'));
            const otherVoices = voices.filter(voice => !voice.lang.includes('ko'));
            
            [...koreanVoices, ...otherVoices].forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${voice.name} (${voice.lang})`;
                if (voice.default) option.textContent += ' - 기본';
                voiceSelect.appendChild(option);
            });
            
            // 첫 번째 한국어 음성을 기본으로 선택
            if (koreanVoices.length > 0) {
                const koreanIndex = voices.indexOf(koreanVoices[0]);
                voiceSelect.value = koreanIndex;
            }
        }

        // 범위 슬라이더 값 업데이트
        function updateRangeValues() {
            document.getElementById('rateValue').textContent = document.getElementById('rateRange').value;
            document.getElementById('pitchValue').textContent = document.getElementById('pitchRange').value;
            document.getElementById('volumeValue').textContent = document.getElementById('volumeRange').value;
        }

        // 음성 재생
        function speakText() {
            const text = document.getElementById('textInput1').value;
            if (!text.trim()) {
                updateStatus('status1', '텍스트를 입력해주세요.', 'error');
                return;
            }

            stopSpeaking();
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            
            // 음성 설정 적용
            const voiceIndex = document.getElementById('voiceSelect').value;
            if (voices[voiceIndex]) {
                currentUtterance.voice = voices[voiceIndex];
            }
            
            currentUtterance.rate = parseFloat(document.getElementById('rateRange').value);
            currentUtterance.pitch = parseFloat(document.getElementById('pitchRange').value);
            currentUtterance.volume = parseFloat(document.getElementById('volumeRange').value);
            
            // 이벤트 리스너
            currentUtterance.onstart = () => {
                updateStatus('status1', '🔊 음성 재생 중...', 'loading');
            };
            
            currentUtterance.onend = () => {
                updateStatus('status1', '✅ 음성 재생 완료', 'success');
            };
            
            currentUtterance.onerror = (event) => {
                updateStatus('status1', `❌ 오류: ${event.error}`, 'error');
            };
            
            speechSynthesis.speak(currentUtterance);
        }

        // 음성 정지
        function stopSpeaking() {
            speechSynthesis.cancel();
            currentUtterance = null;
        }

        // 음성 일시정지
        function pauseSpeaking() {
            speechSynthesis.pause();
        }

        // 음성 재개
        function resumeSpeaking() {
            speechSynthesis.resume();
        }

        // 페이지 텍스트 로드
        function loadPresetText(pageKey) {
            const text = PAGE_VOICE_SCRIPTS[pageKey];
            document.getElementById('textInput2').value = text;
            updateStatus('status2', `📱 ${pageKey} 페이지 텍스트 로드됨`, 'success');
        }

        // 페이지 음성 재생
        function speakPageText() {
            const text = document.getElementById('textInput2').value;
            if (!text.trim()) {
                updateStatus('status2', '먼저 페이지를 선택해주세요.', 'error');
                return;
            }

            document.getElementById('textInput1').value = text;
            speakText();
            updateStatus('status2', '🔊 페이지 음성 안내 재생 중...', 'loading');
        }

        // 전체 페이지 테스트
        async function testAllPages() {
            updateStatus('status2', '🎯 전체 페이지 테스트 시작...', 'loading');
            
            const pageKeys = Object.keys(PAGE_VOICE_SCRIPTS);
            
            for (let i = 0; i < pageKeys.length; i++) {
                const pageKey = pageKeys[i];
                loadPresetText(pageKey);
                
                updateStatus('status2', `📱 ${pageKey} 테스트 중... (${i + 1}/${pageKeys.length})`, 'loading');
                
                // 각 페이지당 3초 재생 후 다음으로
                await new Promise(resolve => {
                    const text = PAGE_VOICE_SCRIPTS[pageKey].substring(0, 100) + "...";
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 1.2; // 빠르게 재생
                    utterance.onend = resolve;
                    speechSynthesis.speak(utterance);
                });
                
                await new Promise(resolve => setTimeout(resolve, 1000)); // 1초 간격
            }
            
            updateStatus('status2', '✅ 전체 페이지 테스트 완료!', 'success');
        }

        // 상태 업데이트
        function updateStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        // 초기화
        function initialize() {
            // 음성 로드 (브라우저마다 다를 수 있음)
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = initVoices;
            }
            setTimeout(initVoices, 100);
            
            // 범위 슬라이더 이벤트
            ['rateRange', 'pitchRange', 'volumeRange'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateRangeValues);
            });
            
            updateRangeValues();
            
            console.log('🎤 AI 음성 테스트 초기화 완료');
            updateStatus('status1', '음성 시스템 준비 완료', 'success');
        }

        // 페이지 로드 시 초기화
        window.addEventListener('load', initialize);
    </script>
</body>
</html>
