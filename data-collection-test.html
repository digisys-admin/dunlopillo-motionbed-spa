<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë˜ë¡­í•„ë¡œ SPA - ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        h2 {
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            margin-top: 30px;
        }

        .section {
            margin: 25px 0;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 4px solid #4299e1;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .primary { background: #4299e1; color: white; }
        .success { background: #48bb78; color: white; }
        .warning { background: #ed8936; color: white; }
        .info { background: #38b2ac; color: white; }

        .rating-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .rating-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #4a5568;
            font-weight: bold;
            font-size: 16px;
        }

        .rating-btn:hover {
            background: #ffd700;
            color: #2d3748;
        }

        .rating-btn.selected {
            background: #ffd700;
            color: #2d3748;
            box-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        #log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 20px;
        }

        .status-card {
            background: #2d3748;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .status-card h3 {
            margin: 0 0 10px 0;
            color: #90cdf4;
        }

        .status-value {
            font-family: monospace;
            background: #4a5568;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin: 2px;
        }

        .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ ë˜ë¡­í•„ë¡œ SPA - ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
        <div class="section">
            <h2><span class="emoji">ğŸ“Š</span>ì‹œìŠ¤í…œ ìƒíƒœ</h2>
            <button class="primary" onclick="checkSystemStatus()">ìƒíƒœ í™•ì¸</button>
            <button class="secondary" onclick="checkScriptLoadingStatus()">ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ</button>
            <button class="info" onclick="showDebugInfo()">ìƒì„¸ ë””ë²„ê¹… ì •ë³´</button>
            <button class="info" onclick="showCurrentData()">ìˆ˜ì§‘ëœ ë°ì´í„° ì¡°íšŒ</button>
            <button class="warning" onclick="resetAllData()">ë°ì´í„° ì´ˆê¸°í™”</button>
            <div id="systemStatus"></div>
        </div>

        <!-- ì„¤ë¬¸ì¡°ì‚¬ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2><span class="emoji">ğŸ“</span>ì„¤ë¬¸ì¡°ì‚¬ í…ŒìŠ¤íŠ¸</h2>
            
            <div>
                <strong>ì„±ë³„:</strong>
                <div class="btn-group">
                    <button class="primary" onclick="saveSurvey('gender', 'ë‚¨ì„±')">ë‚¨ì„±</button>
                    <button class="primary" onclick="saveSurvey('gender', 'ì—¬ì„±')">ì—¬ì„±</button>
                </div>
            </div>

            <div>
                <strong>ë§¤íŠ¸ë¦¬ìŠ¤ ê²½í—˜:</strong>
                <div class="btn-group">
                    <button class="success" onclick="saveSurvey('experience', 'ì²˜ìŒ')">ì²˜ìŒ</button>
                    <button class="success" onclick="saveSurvey('experience', 'ê²½í—˜ìˆìŒ')">ê²½í—˜ìˆìŒ</button>
                </div>
            </div>

            <div>
                <strong>ì—°ë ¹ëŒ€:</strong>
                <div class="btn-group">
                    <button class="info" onclick="saveSurvey('age', '20ëŒ€')">20ëŒ€</button>
                    <button class="info" onclick="saveSurvey('age', '30ëŒ€')">30ëŒ€</button>
                    <button class="info" onclick="saveSurvey('age', '40ëŒ€')">40ëŒ€</button>
                    <button class="info" onclick="saveSurvey('age', '50ëŒ€')">50ëŒ€</button>
                    <button class="info" onclick="saveSurvey('age', '60ëŒ€ ì´ìƒ')">60ëŒ€ ì´ìƒ</button>
                </div>
            </div>
        </div>

        <!-- ë³„ì  í‰ê°€ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2><span class="emoji">â­</span>ë³„ì  í‰ê°€ í…ŒìŠ¤íŠ¸</h2>
            
            <div>
                <strong>Page5 - ì²´í—˜ ë§Œì¡±ë„:</strong>
                <div class="rating-group">
                    <button class="rating-btn" onclick="saveRating('page5', 1)">1</button>
                    <button class="rating-btn" onclick="saveRating('page5', 2)">2</button>
                    <button class="rating-btn" onclick="saveRating('page5', 3)">3</button>
                    <button class="rating-btn" onclick="saveRating('page5', 4)">4</button>
                    <button class="rating-btn" onclick="saveRating('page5', 5)">5</button>
                </div>
            </div>

            <div>
                <strong>Page8 - ì œí’ˆ ë§Œì¡±ë„:</strong>
                <div class="rating-group">
                    <button class="rating-btn" onclick="saveRating('page8', 1)">1</button>
                    <button class="rating-btn" onclick="saveRating('page8', 2)">2</button>
                    <button class="rating-btn" onclick="saveRating('page8', 3)">3</button>
                    <button class="rating-btn" onclick="saveRating('page8', 4)">4</button>
                    <button class="rating-btn" onclick="saveRating('page8', 5)">5</button>
                </div>
            </div>

            <div>
                <strong>Page12 - êµ¬ë§¤ ì˜í–¥:</strong>
                <div class="rating-group">
                    <button class="rating-btn" onclick="saveRating('page12', 1)">1</button>
                    <button class="rating-btn" onclick="saveRating('page12', 2)">2</button>
                    <button class="rating-btn" onclick="saveRating('page12', 3)">3</button>
                    <button class="rating-btn" onclick="saveRating('page12', 4)">4</button>
                    <button class="rating-btn" onclick="saveRating('page12', 5)">5</button>
                </div>
            </div>

            <div>
                <strong>Page18 - ì¶”ì²œ ì˜í–¥:</strong>
                <div class="rating-group">
                    <button class="rating-btn" onclick="saveRating('page18', 1)">1</button>
                    <button class="rating-btn" onclick="saveRating('page18', 2)">2</button>
                    <button class="rating-btn" onclick="saveRating('page18', 3)">3</button>
                    <button class="rating-btn" onclick="saveRating('page18', 4)">4</button>
                    <button class="rating-btn" onclick="saveRating('page18', 5)">5</button>
                </div>
            </div>
        </div>

        <!-- API ì„¤ì • -->
        <div class="section">
            <h2><span class="emoji">ğŸ”—</span>API ì„¤ì •</h2>
            <input type="url" id="apiEndpoint" placeholder="Google Apps Script ì›¹ ì•± URL ì…ë ¥" 
                   style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; margin: 10px 0;">
            <div class="btn-group">
                <button class="warning" onclick="setApiEndpoint()">API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •</button>
                <button class="info" onclick="testApiConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <button class="primary" onclick="showCurrentEndpoint()">í˜„ì¬ URL í™•ì¸</button>
                <button class="success" onclick="openGoogleAppsScript()">Google Apps Script ì—´ê¸°</button>
                <button class="secondary" onclick="testWithCurl()">cURL ëª…ë ¹ì–´ ìƒì„±</button>
            </div>
        </div>

        <!-- ì¼ê´„ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2><span class="emoji">ğŸš€</span>ì¼ê´„ í…ŒìŠ¤íŠ¸</h2>
            <button class="success" onclick="runFullTest()">ì „ì²´ ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸</button>
            <button class="primary" onclick="testLegacyCompatibility()">ë ˆê±°ì‹œ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸</button>
        </div>

        <!-- ë¡œê·¸ -->
        <div class="section">
            <h2><span class="emoji">ğŸ“„</span>ì‹¤ì‹œê°„ ë¡œê·¸</h2>
            <button class="info" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            <div id="log"></div>
        </div>
    </div>

    <!-- JavaScript íŒŒì¼ë“¤ ë¡œë“œ -->
    <script>
        // ì „ì—­ ë””ë²„ê¹… ì •ë³´
        window.debugInfo = {
            loadingStartTime: Date.now(),
            scriptLoadingStatus: {
                manager: false,
                legacy: false
            },
            errors: [],
            logs: []
        };
        
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜
        function debugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            window.debugInfo.logs.push(logMessage);
            console.log('ğŸ› DEBUG:', logMessage);
        }
        
        debugLog('ë””ë²„ê¹… ì‹œì‘');
        
        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.addEventListener('error', (e) => {
            const errorInfo = {
                filename: e.filename,
                message: e.message,
                lineno: e.lineno,
                colno: e.colno,
                stack: e.error ? e.error.stack : 'Stack not available'
            };
            window.debugInfo.errors.push(errorInfo);
            console.error('ğŸš¨ ì „ì—­ ì˜¤ë¥˜:', errorInfo);
            debugLog(`ì˜¤ë¥˜ ë°œìƒ: ${e.message} (${e.filename}:${e.lineno})`);
        });
        
        // Promise rejection í•¸ë“¤ëŸ¬
        window.addEventListener('unhandledrejection', (e) => {
            const errorInfo = {
                reason: e.reason,
                promise: e.promise
            };
            window.debugInfo.errors.push(errorInfo);
            console.error('ğŸš¨ ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', errorInfo);
            debugLog(`Promise ê±°ë¶€: ${e.reason}`);
        });
    </script>
    
    <script src="survey-data-manager.js" 
            onload="window.debugInfo.scriptLoadingStatus.manager = true; debugLog('survey-data-manager.js ë¡œë“œ ì™„ë£Œ');" 
            onerror="debugLog('survey-data-manager.js ë¡œë“œ ì‹¤íŒ¨'); console.error('âŒ survey-data-manager.js ë¡œë“œ ì‹¤íŒ¨');"></script>
    <script src="survey-data.js" 
            onload="window.debugInfo.scriptLoadingStatus.legacy = true; debugLog('survey-data.js ë¡œë“œ ì™„ë£Œ');" 
            onerror="debugLog('survey-data.js ë¡œë“œ ì‹¤íŒ¨'); console.error('âŒ survey-data.js ë¡œë“œ ì‹¤íŒ¨');"></script>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ì½˜ì†” ë¡œê·¸ ìº¡ì²˜
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            originalLog.apply(console, args);
            log('LOG: ' + args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            log('ERROR: ' + args.join(' '));
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log('WARN: ' + args.join(' '));
        };

        // ìƒì„¸ ë””ë²„ê¹… ì •ë³´ í‘œì‹œ
        function showDebugInfo() {
            log('ğŸ› === ìƒì„¸ ë””ë²„ê¹… ì •ë³´ ===');
            log(`ë¡œë”© ì‹œì‘ ì‹œê°„: ${new Date(window.debugInfo.loadingStartTime).toLocaleTimeString()}`);
            log(`ê²½ê³¼ ì‹œê°„: ${Date.now() - window.debugInfo.loadingStartTime}ms`);
            log('');
            
            log('ğŸ“¦ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ:');
            log(`- survey-data-manager.js: ${window.debugInfo.scriptLoadingStatus.manager ? 'âœ…' : 'âŒ'}`);
            log(`- survey-data.js: ${window.debugInfo.scriptLoadingStatus.legacy ? 'âœ…' : 'âŒ'}`);
            log('');
            
            log('ğŸŒ ì „ì—­ ê°ì²´ ìƒíƒœ:');
            log(`- window.surveyDataManager: ${window.surveyDataManager ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}`);
            log(`- window.SurveyDataManager: ${window.SurveyDataManager ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}`);
            log(`- typeof SurveyDataManager: ${typeof SurveyDataManager}`);
            log('');
            
            if (window.debugInfo.errors.length > 0) {
                log('ğŸš¨ ë°œìƒí•œ ì˜¤ë¥˜ë“¤:');
                window.debugInfo.errors.forEach((error, index) => {
                    log(`${index + 1}. ${error.message || error.reason}`);
                    if (error.filename) log(`   íŒŒì¼: ${error.filename}:${error.lineno}`);
                    if (error.stack) log(`   ìŠ¤íƒ: ${error.stack.substring(0, 100)}...`);
                });
            } else {
                log('âœ… ì˜¤ë¥˜ ì—†ìŒ');
            }
            log('');
            
            log('ğŸ“‹ ë””ë²„ê·¸ ë¡œê·¸:');
            window.debugInfo.logs.forEach(logEntry => {
                log(logEntry);
            });
        }

        // ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ í™•ì¸
        function checkScriptLoadingStatus() {
            log('ğŸ“¦ ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ:');
            log(`- survey-data-manager.js: ${window.debugInfo.scriptLoadingStatus.manager ? 'âœ…' : 'âŒ'}`);
            log(`- survey-data.js: ${window.debugInfo.scriptLoadingStatus.legacy ? 'âœ…' : 'âŒ'}`);
            log(`- window.surveyDataManager: ${window.surveyDataManager ? 'âœ…' : 'âŒ'}`);
            log(`- window.SurveyDataManager: ${window.SurveyDataManager ? 'âœ…' : 'âŒ'}`);
            
            // ì¶”ê°€ ì§„ë‹¨
            if (!window.surveyDataManager && window.debugInfo.scriptLoadingStatus.manager) {
                log('âš ï¸  ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¡œë“œë˜ì—ˆì§€ë§Œ surveyDataManagerê°€ ì—†ìŠµë‹ˆë‹¤');
                log('â†’ ì´ˆê¸°í™” ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ê°€ëŠ¥ì„±');
            }
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ (ë¡œë”© ëŒ€ê¸° í¬í•¨)
        function checkSystemStatus() {
            // SurveyDataManager ë¡œë”© ëŒ€ê¸°
            if (!window.surveyDataManager) {
                log('â³ SurveyDataManager ë¡œë”© ëŒ€ê¸° ì¤‘...');
                setTimeout(checkSystemStatus, 500);
                return;
            }

            try {
                const status = window.surveyDataManager.getSystemStatus();
                const statusDiv = document.getElementById('systemStatus');
                
                statusDiv.innerHTML = `
                    <div class="status-card">
                        <h3>ğŸ“± ì‹œìŠ¤í…œ ì •ë³´</h3>
                        <div class="status-value">í…Œë¸”ë¦¿ ID: ${status.tabletId}</div>
                        <div class="status-value">ì‚¬ìš©ì ID: ${status.userId}</div>
                        <div class="status-value">ì„¸ì…˜ ì‹œê°„: ${Math.floor(status.sessionDuration / 1000)}ì´ˆ</div>
                    </div>
                    <div class="status-card">
                        <h3>ğŸ“Š ë°ì´í„° í˜„í™©</h3>
                        <div class="status-value">ì„¤ë¬¸ ì™„ë£Œ: ${status.surveyComplete ? 'âœ…' : 'âŒ'}</div>
                        <div class="status-value">ë³„ì  ê°œìˆ˜: ${status.ratingsCount}/4</div>
                        <div class="status-value">ë°ì´í„° ì „ì†¡: ${status.dataTransmitted ? 'âœ…' : 'âŒ'}</div>
                    </div>
                    <div class="status-card">
                        <h3>ğŸ”— API ì„¤ì •</h3>
                        <div class="status-value">ì—”ë“œí¬ì¸íŠ¸: ${status.apiEndpoint}</div>
                    </div>
                `;
                
                log('âœ… SurveyDataManager ë¡œë“œ ì™„ë£Œ - ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì™„ë£Œ');
            } catch (error) {
                log(`âŒ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // í˜„ì¬ ë°ì´í„° ì¡°íšŒ (ë¡œë”© ëŒ€ê¸° í¬í•¨)
        function showCurrentData() {
            if (!window.surveyDataManager) {
                log('â³ SurveyDataManager ë¡œë”© ëŒ€ê¸° ì¤‘...');
                setTimeout(showCurrentData, 500);
                return;
            }

            try {
                const data = window.surveyDataManager.getCurrentData();
                log('ğŸ“Š í˜„ì¬ ìˆ˜ì§‘ëœ ë°ì´í„°:');
                log(JSON.stringify(data, null, 2));
            } catch (error) {
                log(`âŒ ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // ì„¤ë¬¸ ì‘ë‹µ ì €ì¥
        function saveSurvey(question, answer) {
            if (!window.surveyDataManager) {
                log('âŒ SurveyDataManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            window.surveyDataManager.saveSurveyResponse(question, answer);
            log(`ğŸ“ ì„¤ë¬¸ ì‘ë‹µ ì €ì¥: ${question} = ${answer}`);
        }

        // ë³„ì  ì €ì¥
        function saveRating(page, rating) {
            if (!window.surveyDataManager) {
                log('âŒ SurveyDataManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            window.surveyDataManager.saveRating(page, rating);
            log(`â­ ë³„ì  ì €ì¥: ${page} = ${rating}ì `);

            // ì„ íƒëœ ë²„íŠ¼ í‘œì‹œ
            const buttons = document.querySelectorAll(`[onclick="saveRating('${page}', ${rating})"]`);
            buttons.forEach(btn => btn.classList.add('selected'));
            
            // ê°™ì€ ê·¸ë£¹ì˜ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ ì„ íƒ í•´ì œ
            const allButtons = document.querySelectorAll(`[onclick*="saveRating('${page}',"]`);
            allButtons.forEach(btn => {
                if (!btn.onclick.toString().includes(`${rating}`)) {
                    btn.classList.remove('selected');
                }
            });
        }

        // API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
        function setApiEndpoint() {
            const endpoint = document.getElementById('apiEndpoint').value;
            if (!endpoint) {
                log('âŒ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            if (!window.surveyDataManager) {
                log('âŒ SurveyDataManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            window.surveyDataManager.setApiEndpoint(endpoint);
            log(`ğŸ”— API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •: ${endpoint}`);
        }

        // í˜„ì¬ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
        function showCurrentEndpoint() {
            if (!window.surveyDataManager) {
                log('âŒ SurveyDataManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            const status = window.surveyDataManager.getSystemStatus();
            log(`ğŸ”— í˜„ì¬ API ì—”ë“œí¬ì¸íŠ¸: ${status.apiEndpoint}`);
        }

        // API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testApiConnection() {
            if (!window.surveyDataManager) {
                log('âŒ SurveyDataManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            log('ğŸ”„ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const endpoint = window.surveyDataManager._apiEndpoint;
            log(`ğŸ”— í…ŒìŠ¤íŠ¸ ëŒ€ìƒ URL: ${endpoint}`);
            
            try {
                // 1ë‹¨ê³„: ê¸°ë³¸ GET ìš”ì²­ìœ¼ë¡œ ì„œë²„ ì ‘ê·¼ í™•ì¸
                log('1ï¸âƒ£ ë‹¨ê³„ 1: GET ìš”ì²­ìœ¼ë¡œ ì„œë²„ ì ‘ê·¼ í™•ì¸...');
                try {
                    const getResponse = await fetch(endpoint, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    log(`ğŸ“¡ GET ì‘ë‹µ ìƒíƒœ: ${getResponse.status} ${getResponse.statusText}`);
                    const getText = await getResponse.text();
                    log(`ğŸ“„ GET ì‘ë‹µ ë‚´ìš©: ${getText.substring(0, 200)}...`);
                } catch (getError) {
                    log(`âŒ GET ìš”ì²­ ì‹¤íŒ¨: ${getError.message}`);
                }
                
                // 2ë‹¨ê³„: POST ìš”ì²­ìœ¼ë¡œ ì‹¤ì œ í…ŒìŠ¤íŠ¸
                log('2ï¸âƒ£ ë‹¨ê³„ 2: POST ìš”ì²­ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì „ì†¡...');
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                const testData = {
                    tabletId: 'TEST_TABLET',
                    userId: 'TEST_USER',
                    survey: { gender: 'í…ŒìŠ¤íŠ¸', experience: 'í…ŒìŠ¤íŠ¸', age: 'í…ŒìŠ¤íŠ¸' },
                    ratings: { page5: 1, page8: 2, page12: 3, page18: 4 },
                    sessionStart: new Date().toISOString(),
                    sessionEnd: new Date().toISOString(),
                    ipAddress: 'test',
                    browserInfo: 'test',
                    isFinal: true,
                    timestamp: new Date().toISOString(),
                    isTest: true  // í…ŒìŠ¤íŠ¸ ë°ì´í„°ì„ì„ í‘œì‹œ
                };

                log(`ğŸ“¤ ì „ì†¡í•  ë°ì´í„°: ${JSON.stringify(testData, null, 2)}`);

                // POST ìš”ì²­ ì‹¤í–‰
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData),
                    mode: 'cors'
                });

                log(`ğŸ“¡ POST ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
                log(`ğŸ“‹ ì‘ë‹µ í—¤ë”: ${JSON.stringify([...response.headers.entries()])}`);

                if (response.ok) {
                    const result = await response.json();
                    log('âœ… API ì—°ê²° ì„±ê³µ!');
                    log(`ğŸ“„ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(result, null, 2)}`);
                } else {
                    log(`âŒ API ì—°ê²° ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
                    const errorText = await response.text();
                    log(`ğŸ“„ ì˜¤ë¥˜ ë‚´ìš©: ${errorText}`);
                }
            } catch (error) {
                log(`âŒ API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                log(`ğŸ” ì˜¤ë¥˜ íƒ€ì…: ${error.name}`);
                log(`ğŸ“‹ ì˜¤ë¥˜ ìŠ¤íƒ: ${error.stack}`);
                log('');
                log('ğŸ’¡ ê°€ëŠ¥í•œ ì›ì¸:');
                log('   1. Google Apps Script URLì´ ì˜ëª»ë¨');
                log('   2. ì›¹ ì•±ì´ "ëª¨ë“  ì‚¬ìš©ì" ê¶Œí•œìœ¼ë¡œ ë°°í¬ë˜ì§€ ì•ŠìŒ');
                log('   3. CORS ì„¤ì • ë¬¸ì œ');
                log('   4. Google Apps Script ì½”ë“œ ì˜¤ë¥˜');
                log('   5. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ');
                log('');
                log('ğŸ”§ í•´ê²° ë°©ë²•:');
                log('   1. Google Apps Script ì½˜ì†”ì—ì„œ ë°°í¬ ìƒíƒœ í™•ì¸');
                log('   2. ì‹¤í–‰ ê¶Œí•œì„ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •');
                log('   3. ìƒˆ ë°°í¬ ë²„ì „ ìƒì„±');
            }
        }

        // Google Apps Script ì—´ê¸°
        function openGoogleAppsScript() {
            const endpoint = window.surveyDataManager._apiEndpoint;
            log(`ğŸ”— Google Apps Script URL: ${endpoint}`);
            log('ğŸŒ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”');
            window.open(endpoint, '_blank');
        }

        // cURL ëª…ë ¹ì–´ ìƒì„±
        function testWithCurl() {
            const endpoint = window.surveyDataManager._apiEndpoint;
            const testData = {
                tabletId: 'TEST_TABLET',
                userId: 'TEST_USER',
                survey: { gender: 'í…ŒìŠ¤íŠ¸', experience: 'í…ŒìŠ¤íŠ¸', age: 'í…ŒìŠ¤íŠ¸' },
                ratings: { page5: 1, page8: 2, page12: 3, page18: 4 },
                sessionStart: new Date().toISOString(),
                sessionEnd: new Date().toISOString(),
                ipAddress: 'test',
                browserInfo: 'test',
                isFinal: true,
                timestamp: new Date().toISOString(),
                isTest: true
            };

            const curlCommand = `curl -X POST "${endpoint}" \\
  -H "Content-Type: application/json" \\
  -d '${JSON.stringify(testData, null, 2)}'`;

            log('ğŸ“‹ í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë³´ì„¸ìš”:');
            log('');
            log(curlCommand);
            log('');
            log('ğŸ’¡ ì´ ëª…ë ¹ì–´ë¡œ ì§ì ‘ API í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤');
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸
        function runFullTest() {
            log('ğŸš€ ì „ì²´ ë°ì´í„° ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            // ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„°
            saveSurvey('gender', 'ë‚¨ì„±');
            setTimeout(() => saveSurvey('experience', 'ì²˜ìŒ'), 500);
            setTimeout(() => saveSurvey('age', '30ëŒ€'), 1000);
            
            // ë³„ì  ë°ì´í„°
            setTimeout(() => saveRating('page5', 5), 1500);
            setTimeout(() => saveRating('page8', 4), 2000);
            setTimeout(() => saveRating('page12', 3), 2500);
            setTimeout(() => saveRating('page18', 5), 3000);
            
            setTimeout(() => {
                log('âœ… ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                showCurrentData();
            }, 3500);
        }

        // ë ˆê±°ì‹œ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        function testLegacyCompatibility() {
            log('ğŸ”„ ë ˆê±°ì‹œ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            if (!window.surveyData) {
                log('âŒ window.surveyDataê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            if (!window.saveSurveyResponse || !window.saveRating) {
                log('âŒ ì „ì—­ í•¨ìˆ˜ë“¤ì´ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            // ë ˆê±°ì‹œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
            window.saveSurveyResponse('gender', 'ì—¬ì„±');
            window.saveRating(5, 4);
            
            // ë ˆê±°ì‹œ ê°ì²´ í…ŒìŠ¤íŠ¸
            log('ğŸ“Š ë ˆê±°ì‹œ ì‘ë‹µ ë°ì´í„°:');
            log(JSON.stringify(window.surveyData.responses, null, 2));
            
            log('âœ… ë ˆê±°ì‹œ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        // ë°ì´í„° ì´ˆê¸°í™”
        function resetAllData() {
            if (!window.surveyDataManager) {
                log('âŒ SurveyDataManagerê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                return;
            }

            window.surveyDataManager.resetData();
            log('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            
            // ì„ íƒëœ ë²„íŠ¼ë“¤ ì´ˆê¸°í™”
            document.querySelectorAll('.rating-btn.selected').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLog() {
            document.getElementById('log').textContent = '';
            log('ğŸ§¹ ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤');
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
        window.addEventListener('load', () => {
            log('ğŸš€ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ë“¤ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”');
            
            // ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ ë¨¼ì € í™•ì¸
            checkScriptLoadingStatus();
            
            // SurveyDataManager ë¡œë”© ìƒíƒœ í™•ì¸
            if (window.surveyDataManager) {
                log('âœ… SurveyDataManager ì´ë¯¸ ë¡œë“œë¨');
                checkSystemStatus();
            } else {
                log('â³ SurveyDataManager ë¡œë”© ëŒ€ê¸°...');
                // ì‹œìŠ¤í…œ ìƒíƒœ ìë™ í™•ì¸ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
                setTimeout(checkSystemStatus, 100);
            }
        });
    </script>
</body>
</html>
